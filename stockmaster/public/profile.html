<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile - StockMaster</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="app-container">
      <aside class="sidebar">
        <div class="sidebar-header"><h2>ğŸ“¦ StockMaster</h2></div>
        <nav class="sidebar-nav">
          <a href="/dashboard.html" class="nav-item"
            ><span>ğŸ“Š</span> Dashboard</a
          >
          <a href="/products.html" class="nav-item"><span>ğŸ“¦</span> Products</a>
          <a href="/receipts.html" class="nav-item"><span>ğŸ“¥</span> Receipts</a>
          <a href="/deliveries.html" class="nav-item"
            ><span>ğŸ“¤</span> Deliveries</a
          >
          <a href="/transfers.html" class="nav-item"
            ><span>ğŸ”„</span> Transfers</a
          >
          <a href="/adjustments.html" class="nav-item"
            ><span>âš™ï¸</span> Adjustments</a
          >
          <a href="/warehouses.html" class="nav-item"
            ><span>ğŸ­</span> Warehouses</a
          >
        </nav>
        <div class="sidebar-footer">
          <a href="/profile.html" class="nav-item active"
            ><span>ğŸ‘¤</span> Profile</a
          >
          <a href="#" id="logoutBtn" class="nav-item"><span>ğŸšª</span> Logout</a>
        </div>
      </aside>

      <main class="main-content">
        <header class="content-header">
          <h1>My Profile</h1>
        </header>

        <div class="card" style="max-width: 600px">
          <div class="card-body">
            <form id="profileForm">
              <div class="form-group">
                <label>Name</label>
                <input type="text" id="profileName" required />
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="profileEmail" readonly disabled />
              </div>
              <div class="form-group">
                <label>Role</label>
                <input type="text" id="profileRole" readonly disabled />
              </div>
              <button type="submit" class="btn btn-primary">
                Update Profile
              </button>
            </form>
            <div id="message" class="message" style="margin-top: 20px"></div>
          </div>
        </div>
      </main>
    </div>

    <script>
      const API_URL = "http://localhost:3000/api";
      const token = localStorage.getItem("token");

      if (!token) {
        window.location.href = "/login.html";
      }

      document.getElementById("logoutBtn").addEventListener("click", (e) => {
        e.preventDefault();
        localStorage.removeItem("token");
        window.location.href = "/login.html";
      });

      async function loadProfile() {
        try {
          const response = await fetch(`${API_URL}/auth/profile`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          const data = await response.json();
          document.getElementById("profileName").value = data.name;
          document.getElementById("profileEmail").value = data.email;
          document.getElementById("profileRole").value = data.role;
        } catch (error) {
          console.error("Error:", error);
        }
      }

      document
        .getElementById("profileForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const name = document.getElementById("profileName").value;

          try {
            const response = await fetch(`${API_URL}/auth/profile`, {
              method: "PUT",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ name }),
            });

            const msgEl = document.getElementById("message");
            if (response.ok) {
              msgEl.textContent = "Profile updated successfully!";
              msgEl.className = "message success";
            } else {
              msgEl.textContent = "Failed to update profile";
              msgEl.className = "message error";
            }
          } catch (error) {
            document.getElementById("message").textContent =
              "Error updating profile";
            document.getElementById("message").className = "message error";
          }
        });

      loadProfile();
    </script>
  </body>
</html>
